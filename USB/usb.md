# USB Communication with Additel Calibrators and Devices

Many of the newer Additel devices can communicate over USB cables with USB Communication.  These cables can be USB-A to USB-A or USB-A to USB-B.  This method of communication is very simple and effective.s

## Setup

First, make sure you get the driver for your particular RS-232 cable installed.  If you don't have the driver, your system is not going to be able to communicate with the device.

In this example, we are going to use Python 3 (in this case, version 3.9.1, although newer versions should work fine too), which you can download [here](https://www.python.org/downloads/) or [here](https://www.microsoft.com/en-us/p/python-39/9p7qfqmjrfp7).

You'll also need to install pySerial, by following the instructions [here](https://pyserial.readthedocs.io/en/latest/pyserial.html#installation).  pySerial is a 3rd party library that makes communicating with serial devices really easy.

## Example

```python
# import the pyserial library
import serial

# open a serial port
port = serial.Serial(   port='COM1',
                        baudrate=9600,
                        bytesize=serial.EIGHTBITS,
                        parity=serial.PARITY_NONE,
                        stopbits=serial.STOPBITS_ONE,
                        timeout=1   )


# encode the command to get the device SN in bytes, and write it to the device
command = "255:R:OCODE:1\r\n"
command_in_bytes = bytes(command, 'utf-8')
port.write(command_in_bytes)

# read the first 500 characters (or less if it times out), convert it to a string, and print it
response = port.read(size=500)
response_as_str = bytes.decode(response, 'utf-8')
print(response_as_str)
```

Let's go over this example step by step:

1)  First, we get the pySerial library loaded.

```python
# import the pyserial library
import serial
```

2) Next, we open the serial port.  This is probably the hardest part, because you need to make sure you open the serial port with the correct settings.  These settings are determined in different ways.  For example:

* The Port is automatically generated by your computer once you plug in your RS232 cable and install it's driver (if you don't have a driver installed, you can't interact with the cable).  On Windows, this looks like `COM1` or `COM2`.  On other platforms, it will probably be `/dev/ttyS1` or `/dev/ttyS2`.  You can see a list of these generated ports by using pySerial's `serial.tools.list_ports`, or on Windows, by going to Device Manager, and looking under the `Ports (COM & LPT)` section.

* The Baud Rate is set by your Additel device.  You can oftentimes set it via going into the device settings.  To learn how to do this, check out your device manual on [additel.com](https://www.additel.com).  The default for all Additel devices is `9600`, so if you can't figure out what it is that's a good place to start.

* The Bytes Size and Stop Bits can be changed on some Additel devices, but not on others.  The default for many Additel devices is bytesize of `8` or `7`, and stopbits of `1` or `2`, so try a few combinations of those.

* The Parity is always `None`.

```python
# open a serial port
port = serial.Serial(   port='COM1',
                        baudrate=9600,
                        bytesize=serial.EIGHTBITS,
                        parity=serial.PARITY_NONE,
                        stopbits=serial.STOPBITS_ONE,
                        timeout=1   )
```

1) Once you get the serial port set up, you need to write some data to the port.  Unfortunately, the port only likes binary data so you need to convert it to bytes before sending (other serial libraries may not need to do this).  You can find these commands in your product's user manual on [additel.com](https://www.additel.com) most of the time. (Go to the Products section and look for your product.  Then check the Resources tab.)  If you can't find them there, [send us an email](https://www.additel.com/contactus.html/) and we'll get the commands to you if they are available.  Commands for Additel units tend to come in one of two structures:

* The first structure is called an SCPI command.  To describe how this structure works, we will reference TODO

* The second structure (as shown in the code below), is a typical command. To describe how this structure works, we will reference `255:R:OCODE:1\r\n`, which is a command from the [ADT681 manual](https://www.additel.com/download/user%20manual/User%20Manual/681%20User%20Manual.pdf) in Appendix 1.  You'll notice different parts of this command are separated by colons.  Each part has a separate meaning.  Here's a description of each of the separate parts. `Device Address : Read or Write : Command : Paramater 1 : Paramater 2 : Paramater 3 : Paramater 4 \r\n`.  For `Device Address`, we always reccomed you use `255` (as it will always work with our devices).  For `Read or Write`, `Command` and any of the `Paramater`s, you'll need to look up the information in your devices user manual Appendix as we described above.  `Read or Write` is a `R` or `W` (although both will not be available for all commands).  `Command` is a 4-6 character string that represents an action we want to do.  For example, in the case of `OCODE` below, if used with an ADT681, it gets the unit's serial number and returns it to you.  `Paramater`s are required for some commands which require you to send information to your unit.  For example, if you had an ADT681 and you wanted to set your guage's internal recording (using the `OFTIM` command) to 1 record every 10 seconds, you could stick the paramater `10` at the end like this: `255:R:OFTIM:10\r\n`.  Multiple paramater will be separated by colons, just like the other parts of the command. If there are no paramaters, it is best to end the command with a `1` (as seen with `OCODE`).  Finally, at the very end of your command, put a `\r\n`, which lets your device know that the command has ended.

```python
# encode the command to get the device SN in bytes, and write it to the device
command = "255:R:OCODE:1\r\n"
command_in_bytes = bytes(command, 'utf-8')
port.write(command_in_bytes)
```

4)  Finally you can recieve the response from the Additel device through the port.  pySerial works by specifying an amount of characters you'd like to recieve, and also has a timeout if things take too long (other libraries may do this differently).  The data is returned as bytes, and you need to turn it into a string before printing it.

```python
# read the first 500 characters (or less if it times out), convert it to a string, and print it
response = port.read(size=500)
response_as_str = bytes.decode(response, 'utf-8')
print(response_as_str)
```